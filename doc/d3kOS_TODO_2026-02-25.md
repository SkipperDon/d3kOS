# d3kOS System - TODO List
**Generated:** 2026-02-25 (Updated with accurate documentation review)
**System:** Raspberry Pi 4B, Debian Trixie, d3kOS v2.0-T3
**Current Version:** 0.9.1.2 (Testing Build - Tier 3 Enabled)
**Release Date:** February 22, 2026

---

## ‚úÖ COMPLETED (As of Feb 22-23, 2026)

### Core System Infrastructure
- ‚úÖ **Installation ID System** - 16-char hex (SHA-256 based), file-based storage
- ‚úÖ **Tier System** - Auto-detection, feature restrictions, Tier 2/3 working
- ‚úÖ **License API** - Port 8091, license.json management
- ‚úÖ **Tier API** - Port 8093, tier status and upgrades
- ‚úÖ **Timezone Auto-Detection** - GPS ‚Üí Internet ‚Üí UTC fallback

### Voice Assistant
- ‚úÖ **Vosk Wake Word Detection** - 100% offline, replacing PocketSphinx
- ‚úÖ **Wake Words:** "helm" (auto), "advisor" (onboard), "counsel" (online)
- ‚úÖ **D-Bus Emergency Reboot** - Voice-triggered system reboot working
- ‚úÖ **Pattern Expansion** - 13 instant-answer query types
- ‚úÖ **Signal K Caching** - 3s TTL for 100√ó speedup
- ‚úÖ **Phi-2 LLM Removed** - Feb 16, 2026 (60-180s unusable, freed 1.7GB)
- ‚úÖ **OpenRouter Integration** - gpt-3.5-turbo for complex queries (6-8s)
- ‚úÖ **Test Result** - Feb 22: Voice reboot command working perfectly

### Marine Vision System
- ‚úÖ **Phase 1: Camera Streaming** - Reolink RLC-810A (4K, IP67, night vision)
- ‚úÖ **Camera API** - Port 8084, 6 endpoints (stream, record, capture)
- ‚úÖ **Phase 2.1: Object Detection** - YOLOv8n ONNX model (13MB)
- ‚úÖ **Fish Detector API** - Port 8086, person detection working
- ‚úÖ **Captures Database** - SQLite, initialized and operational
- ‚úÖ **Storage Management** - Auto-cleanup after 7 days

### Network & System Management
- ‚úÖ **Network Settings UI** - Touch-optimized WiFi management (port 8101)
- ‚úÖ **Self-Healing System** - Auto-remediation, monitoring (port 8099)
- ‚úÖ **Backup System** - 36MB compressed backups (port 8100)
- ‚úÖ **Data Export API** - Port 8094, queue + retry logic
- ‚úÖ **Chromium Session Reset** - Prevents "Restore pages?" prompt

### OpenCPN Integration
- ‚úÖ OpenCPN 5.10.2 installed and configured
- ‚úÖ Touchscreen optimization (2x UI scale, 24pt fonts, 64px buttons)
- ‚úÖ /opt/opencpn symlink created for Tier 2 detection
- ‚úÖ Configuration backed up and restored
- ‚ö†Ô∏è **MANUAL STEP REQUIRED:** User must configure Signal K connection in OpenCPN UI
  - Go to: Options ‚Üí Connections ‚Üí Add Network
  - Protocol: SignalK
  - Address: localhost
  - Port: 3000

### System Status
- ‚úÖ Tier 3 active (all features enabled for testing)
- ‚úÖ Installation ID: 3861513b314c5ee7
- ‚úÖ Signal K receiving NMEA2000 data (PGN 127488 from can0.64)
- ‚úÖ GPS position working (43.6868¬∞N, 79.5212¬∞W)
- ‚úÖ All 22+ d3kOS services active and operational

---

## ‚ùå NOT AVAILABLE

### O-Charts Plugin
- ‚ùå **Cannot install** - Not available for OpenCPN 5.10.2 on Debian Trixie ARM64
- Plugin catalog shows no additional plugins
- **Alternative:** Use free charts (OpenSeaMap, NOAA RNC, etc.)
- **Status:** Confirmed unavailable Feb 25, 2026

### WiFi Hotspot Mode
- ‚ùå **Cannot implement** - BCM4345/6 firmware limitation (EOPNOTSUPP error)
- Built-in WiFi card does not support AP mode
- **Alternative:** Manual WiFi connection via Network Settings UI
- **Status:** Documented as hardware incompatible Feb 20, 2026

---

## ‚ö†Ô∏è KNOWN ISSUES

### Voice Assistant - Touchscreen Conflict (CRITICAL)
**Status:** ‚ö†Ô∏è Voice system disabled due to touchscreen conflict
**Last Known Working:** February 22, 2026 (D-Bus reboot test successful)
**Current Issue:** Feb 25, 2026 - Wake word not detecting

**Problem Summary:**
- Vosk wake word detector runs but callback not firing
- Direct Vosk test script works (detected "helm" at 10.07s on Feb 25)
- Service logs show continuous `[DEBUG-LOOP]` but no `[DEBUG-CALLBACK]`
- Microphone signal weak (0.6-0.9% amplitude vs 3.1% working level)
- User reports mute button is OFF, ALSA volume at 100%
- PipeWire not running (not the issue)

**Architecture (Current - Feb 22, 2026):**
```
Microphone ‚Üí Vosk (Wake Word) ‚Üí Callback ‚Üí Query Handler ‚Üí Piper (TTS) ‚Üí Speaker
              ‚Üì                               ‚Üì
        "helm" detected              Rule-Based (13 patterns, 0.17s) OR
                                     OpenRouter gpt-3.5-turbo (6-8s)
```

**Wake Words:**
- **"helm"** ‚Üí Auto-select (rule-based if simple, OpenRouter if complex) ‚Üí "Aye Aye Captain"
- **"advisor"** ‚Üí Force offline (rule-based only, 13 patterns) ‚Üí "Aye Aye Captain"
- **"counsel"** ‚Üí Force online (OpenRouter) ‚Üí "Aye Aye Captain"

**What's Working:**
- ‚úÖ Text-based AI Assistant (http://192.168.1.237/ai-assistant.html)
- ‚úÖ OpenRouter integration (6-8s response, gpt-3.5-turbo)
- ‚úÖ Rule-based patterns (0.17-0.22s, 13 query types)
- ‚úÖ Signal K caching (3s TTL, 100√ó speedup)
- ‚úÖ Conversation history (SQLite)
- ‚úÖ Vosk STT (vosk-model-small-en-us-0.15, 50MB)
- ‚úÖ Piper TTS (en_US-amy-medium voice)
- ‚úÖ Vosk wake word model loads successfully

**What's Not Working:**
- ‚ùå Wake word detection callback not firing in service
- ‚ùå Microphone signal too weak (0.6% vs 3.1% working)
- ‚ùå Voice-triggered commands not responding

**Components:**
- Service: `d3kos-voice.service` (enabled but not detecting)
- Script: `/opt/d3kos/services/voice/voice-assistant-hybrid.py` (v4)
- Wake word module: `/opt/d3kos/services/voice/wake_word_vosk.py`
- AI config: `/opt/d3kos/config/ai-config.json`
- Models: `/opt/d3kos/models/vosk/`, `/opt/d3kos/models/piper/`
- Microphone: Anker S330 at plughw:3,0

**Investigation Timeline:**
- Feb 17: Voice working perfectly, D-Bus reboot tested successfully
- Feb 22: Single wake word system tested, touchscreen conflict noted, voice disabled
- Feb 25: User reports wake word not responding, microphone signal weak

**Next Steps (Recommended):**
1. ‚è≥ Check if microphone hardware changed (USB enumeration, plughw:3,0 still correct)
2. ‚è≥ Test with louder voice/closer to microphone
3. ‚è≥ Check Vosk confidence threshold settings
4. ‚è≥ Restart voice service to see if callback starts working
5. ‚è≥ Check system updates that might have broken compatibility

**Priority:** Medium (voice is Tier 2 feature, text interface fully functional)
**Estimated Debug Time:** 2-3 hours (callback integration issue + signal weakness)

**Workaround:** Text-based AI Assistant works perfectly at http://192.168.1.237/ai-assistant.html

**Documentation References:**
- Implementation: `/home/boatiq/Helm-OS/doc/VOICE_REBOOT_DBUS_IMPLEMENTATION.md`
- Testing: `/home/boatiq/Helm-OS/doc/VOICE_SINGLE_WAKE_TESTING_2026-02-22.md`
- User Guide: `/home/boatiq/Helm-OS/doc/AI_ASSISTANT_USER_GUIDE.md`
- Spec: `/home/boatiq/Helm-OS/MASTER_SYSTEM_SPEC.md` (Section 4.4)

---

## ‚è≥ PENDING COMPLETION

### Marine Vision System

**Status:** Phase 1 + 2.1 COMPLETE, Phase 2.2-2.6 PENDING

**What's Working:**
- ‚úÖ Camera streaming (Reolink RLC-810A at 10.42.0.100)
- ‚úÖ Camera Stream Manager (port 8084)
- ‚úÖ Web UI at http://192.168.1.237/marine-vision.html
- ‚úÖ YOLOv8n detection working (person detection functional)
- ‚úÖ Captures database initialized

**What Needs Work:**
1. ‚è≥ **Phase 2.2: Custom Fish Detection Model** (~8-12 hours)
   - Current: Using "bird" class proxy (doesn't work for actual fish)
   - Need: Roboflow model or custom-trained YOLOv8 fish detector
   - Blocked: Requires user Roboflow account or training dataset

2. ‚è≥ **Phase 2.3: Species Identification** (~8-10 hours)
   - ResNet50 or similar CNN model
   - FishBase API integration
   - GBIF API integration
   - Confidence scoring

3. ‚è≥ **Phase 2.4: Fishing Regulations Database** (~6-8 hours)
   - Ontario MNR database
   - Size/bag limit checking
   - Seasonal restrictions
   - Location-based rules

4. ‚è≥ **Phase 2.5: Regulation Compliance Alerts** (~4-6 hours)
   - Real-time rule checking
   - Warning notifications
   - Catch logging

5. ‚è≥ **Phase 2.6: Telegram Notifications** - ‚úÖ IMPLEMENTED (Feb 17)
   - Service ready: d3kos-notifications.service (port 8088)
   - **User must configure:**
     - Create Telegram bot via @BotFather
     - Get bot token and chat ID
     - Configure: `curl -X POST http://localhost:8088/notify/config -d '{"enabled":true,"bot_token":"...","chat_id":"..."}'`
   - Documentation: `/home/boatiq/Helm-OS/doc/MARINE_VISION_NOTIFICATION_INTEGRATION.md`

**Total Remaining for Phases 2.2-2.5:** ~26-36 hours

---

### Data Export System

**Status:** ‚úÖ Export API Implemented, ‚è≥ Full Integration Pending

**What's Working:**
- ‚úÖ Export Manager API (port 8094)
- ‚úÖ Tier-based export restrictions
- ‚úÖ Export status endpoint
- ‚úÖ Queue + retry logic (3 attempts, 5s delay)

**What Needs Work:**
1. ‚è≥ **Complete All 9 Export Categories** (~4-6 hours):
   - ‚úÖ Engine benchmark data
   - ‚úÖ Boatlog entries
   - ‚è≥ Marine vision metadata (no media files)
   - ‚è≥ Onboarding configuration
   - ‚è≥ QR code data
   - ‚è≥ Settings
   - ‚è≥ Alerts
   - ‚è≥ System info
   - ‚è≥ Telemetry & analytics

2. ‚è≥ **Boot-time Export Service** (~2-3 hours):
   - Auto-upload pending exports on boot
   - Check queue and sync to cloud
   - Background processing

3. ‚è≥ **Central Database Integration** (~4-6 hours):
   - API endpoint configuration
   - Authentication/authorization
   - Error handling and retry
   - Success tracking

**Total Remaining:** ~10-15 hours

---

### E-Commerce Integration

**Status:** ‚úÖ Specification Complete, ‚è≥ Implementation Pending

**What's Done:**
- ‚úÖ Full implementation guide (48KB) at `/home/boatiq/Helm-OS/doc/STRIPE_BILLING_IMPLEMENTATION_GUIDE.md`
- ‚úÖ Database schema designed (3 tables: subscriptions, payments, tier_upgrades)
- ‚úÖ API endpoints documented (8 endpoints)
- ‚úÖ Mobile app integration planned (iOS StoreKit 2, Android Billing Library 5.0+)
- ‚úÖ Stripe Billing workflow designed

**What Needs Work:**
1. ‚è≥ **Backend Services** (~40-60 hours total):
   - Stripe webhook handler (Python/Flask)
   - Subscription management API
   - Apple IAP integration
   - Google Play Billing integration
   - PayPal integration (optional)
   - Database setup (subscriptions, payments, tier_upgrades)

2. ‚è≥ **Mobile App Integration:**
   - iOS StoreKit 2
   - Android Billing Library 5.0+
   - Subscription UI pages
   - Payment history display

**Priority:** Medium (revenue-generating, but large time investment)
**Documentation:** `/home/boatiq/Helm-OS/doc/STRIPE_BILLING_IMPLEMENTATION_GUIDE.md`

---

### Charts Page

**Status:** ‚è≥ Missing chart data

**Issue:**
- Charts page exists but needs chart data
- O-charts plugin not available (see "NOT AVAILABLE" section)

**Solutions:**
1. ‚è≥ **Install free charts** (~1-2 hours):
   - OpenSeaMap (vector charts, free)
   - NOAA RNC (raster charts, USA only, free)
   - Download manually and import to OpenCPN

2. ‚è≥ **Configure chart directories in OpenCPN:**
   - Options ‚Üí Charts ‚Üí Add Directory
   - Point to downloaded chart folders

**Estimated Time:** 1-2 hours (manual chart download + configuration)

---

### Minor UI Fixes

1. ‚è≥ **Network Status UI** - Labels need white color (hard to read)
   - **Priority:** Low
   - **Estimated Fix:** 15 minutes
   - **File:** `/var/www/html/settings-network.html`

2. ‚è≥ **NMEA2000 Simulator Cleanup** - vcan0 causing errors
   - **Status:** Disabled in Signal K settings (2026-02-17)
   - **Action Needed:** Remove simulator files permanently
   - **Priority:** Low
   - **Estimated Time:** 30 minutes

---

## üìä PRIORITY SUMMARY

### Critical (System Not Working):
1. ‚ö†Ô∏è **Voice Assistant Debug** - Wake word not detecting (2-3 hours)
   - Microphone signal too weak (0.6% vs 3.1% working)
   - Callback not firing in service (works in direct test)
   - User reports issue Feb 25, 2026

### High Priority (Important Features):
2. ‚è≥ **OpenCPN Signal K Connection** - User must configure manually (5 min)
3. ‚è≥ **Install Free Charts** - Get basic charting working (1-2 hours)
4. ‚è≥ **Marine Vision Custom Fish Model** - Enable actual fish detection (8-12 hours)

### Medium Priority (Feature Completion):
5. ‚è≥ **Data Export Full Integration** - Complete all 9 categories (10-15 hours)
6. ‚è≥ **Marine Vision Phases 2.3-2.5** - Species ID + regulations (18-24 hours)
7. ‚è≥ **Telegram Notifications Setup** - Fish capture alerts (user config required)

### Low Priority (Nice to Have):
8. ‚è≥ **Network Status UI Color** - Improve readability (15 min)
9. ‚è≥ **Remove NMEA2000 Simulator** - Clean up logs (30 min)

### Long-term Projects (Large Investment):
10. ‚è≥ **E-commerce/Stripe Integration** - Subscription billing (40-60 hours)
11. ‚è≥ **Mobile App Development** - iOS/Android apps (200+ hours)

---

## üíæ STORAGE STATUS

**Current:** 82% used (2.4GB free on 16GB SD card)

**Large Files:**
- OpenCPN + data: ~18MB
- AI Models: ~50MB (voice: 25MB, marine vision: 43MB)
- Camera recordings: Variable (auto-cleanup after 7 days)

**Recommendations:**
1. Monitor disk space regularly
2. Implement media cleanup service (priority)
3. Consider upgrading to 32GB SD card (user has one available)

---

## üéØ QUICK WINS (< 30 minutes each)

1. ‚úÖ Configure OpenCPN ‚Üí Signal K connection (5 min) - **USER ACTION REQUIRED**
2. ‚è≥ Fix network status label colors (15 min)
3. ‚è≥ Remove vcan0 simulator files (30 min)

---

## üìù NOTES

**System Architecture:**
- **OS:** Debian Trixie (13), Kernel 6.12.x
- **Window Manager:** Labwc (Wayland compositor)
- **Node-RED:** v4.1.4
- **Version:** d3kOS v2.0-T3 (0.9.1.2)
- **Services:** 22+ services running
- **Release:** February 22, 2026 (Testing Build)

**System Health:**
- ‚úÖ All critical services running
- ‚úÖ Tier 3 active (all features enabled)
- ‚úÖ NMEA2000 data flowing
- ‚úÖ Camera connected and streaming
- ‚ö†Ô∏è Voice wake word detection not responding (Feb 25 issue)
- ‚ùå O-charts unavailable (use free charts instead)
- ‚ùå WiFi hotspot mode unavailable (hardware limitation)

**Documentation Locations:**
- Marine Vision: `/home/boatiq/Helm-OS/doc/MARINE_VISION*.md`
- Voice System: `/home/boatiq/Helm-OS/doc/VOICE_*.md`
- Stripe Billing: `/home/boatiq/Helm-OS/doc/STRIPE_BILLING_*.md`
- Session Logs: `/home/boatiq/Helm-OS/doc/SESSION_*.md`
- Release Notes: `/home/boatiq/Helm-OS/doc/RELEASE_NOTES_v2.0-T3.md`
- Architecture: `/home/boatiq/Helm-OS/doc/ARCHITECTURE.md`

---

**Last Updated:** 2026-02-25
**System Version:** d3kOS v2.0-T3 (0.9.1.2)
**Tier:** 3 (Enterprise - all features unlocked for testing)
**Installation ID:** 3861513b314c5ee7
