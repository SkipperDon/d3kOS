<!-- FINAL CORRECTED HOMEPAGE - All Issues Fixed -->
<!-- Paste this ENTIRE file into WordPress Pages → Home → Code Editor -->

<!-- Hero Section -->
<section class="hero">
    <div class="container">
        <h1 style="letter-spacing: 0.15em; word-spacing: 0.3em;">SMART MARINE MONITORING FOR MODERN BOATERS</h1>
        <h2>Choose the d3kOS tier that's right for you</h2>
        <p>Open-source marine helm control system with AI assistant, engine monitoring, fish detection, and cloud sync. From free basic monitoring to enterprise fleet management.</p>
    </div>
</section>

<!-- d3kOS Tiers -->
<section class="tiers">
    <div class="container">
        <h2>d3kOS Subscription Tiers</h2>
        <div class="tier-grid">

            <!-- Tier 0 -->
            <div class="tier-card">
                <div class="tier-name">Tier 0</div>
                <div class="tier-price">FREE</div>
                <ul class="tier-features">
                    <li>Dashboard</li>
                    <li>Health monitoring</li>
                    <li>Boat log (30 days)</li>
                    <li>Onboarding wizard</li>
                    <li>10 system resets max</li>
                </ul>
                <a href="#" class="tier-button secondary">Open Source</a>
            </div>

            <!-- Tier 1 -->
            <div class="tier-card">
                <div class="tier-name">Tier 1</div>
                <div class="tier-price">FREE</div>
                <ul class="tier-features">
                    <li>All Tier 0 features</li>
                    <li>Mobile app pairing</li>
                    <li>Remote monitoring</li>
                    <li>Data export</li>
                    <li>Onboarding restore</li>
                </ul>
                <a href="#" class="tier-button secondary">Download App</a>
            </div>

            <!-- Tier 2 - Premium -->
            <div class="tier-card premium">
                <div class="tier-name">Tier 2 - Premium</div>
                <div class="tier-price">$9.99<span class="period">/month</span></div>
                <ul class="tier-features">
                    <li>All Tier 1 features</li>
                    <li>Voice assistant</li>
                    <li>Marine Vision camera</li>
                    <li>Unlimited resets</li>
                    <li>Cloud sync (90 days)</li>
                    <li>AI analysis</li>
                </ul>
                <a href="https://buy.stripe.com/test_dRmeVc34H2kN30C2Md0co00" class="tier-button">Subscribe Now</a>
            </div>

            <!-- Tier 3 - Enterprise -->
            <div class="tier-card premium">
                <div class="tier-name">Tier 3 - Enterprise</div>
                <div class="tier-price">$99.99<span class="period">/year</span></div>
                <ul class="tier-features">
                    <li>All Tier 2 features</li>
                    <li>Multi-boat fleet</li>
                    <li>Advanced analytics</li>
                    <li>Priority support</li>
                    <li>Custom integrations</li>
                    <li>17% savings</li>
                </ul>
                <a href="https://buy.stripe.com/test_7sY3cu8p12kN9p0aeF0co01" class="tier-button">Subscribe Now</a>
            </div>

        </div>
    </div>
</section>

<!-- Hardware Kit Section - CORRECTED -->
<section class="hardware">
    <div class="container">
        <h2>d3-k1 Complete Marine Electronics Kit</h2>
        <h3>Everything you need to transform your boat into a smart vessel</h3>

        <div class="hardware-grid">
            <div class="hardware-item">Raspberry Pi 4B (8GB RAM)</div>
            <div class="hardware-item">PiCAN-M HAT with SMPS</div>
            <div class="hardware-item">CX5106 NMEA2000 Gateway</div>
            <div class="hardware-item">NMEA2000 Backbone</div>
            <div class="hardware-item">Reolink RLC-810A 4K Camera</div>
            <div class="hardware-item">10.1" Touchscreen (1000 nit)</div>
            <div class="hardware-item">GPS Module</div>
            <div class="hardware-item">128GB MicroSD Card</div>
            <div class="hardware-item">IP67 Marine Enclosure</div>
            <div class="hardware-item">Mounting Hardware</div>
            <div class="hardware-item">Pre-configured d3kOS Software</div>
        </div>

        <div class="hardware-price">$999.99 USD</div>
        <a href="/shop" class="tier-button">Pre-Order Now</a>
    </div>
</section>

<!-- Blog Preview - FUNCTIONAL -->
<section class="blog-preview">
    <div class="container">
        <h2>Latest from the Blog</h2>
        <div class="blog-grid" id="blog-posts-container">
            <!-- Blog posts will be dynamically loaded here -->
            <div class="blog-card">
                <div class="blog-card-image">Loading...</div>
                <div class="blog-card-content">
                    <h3>Loading posts...</h3>
                    <p>Please wait while we fetch the latest articles.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
(function() {
    function stripHtml(html) {
        const tmp = document.createElement('DIV');
        tmp.innerHTML = html;
        return tmp.textContent || tmp.innerText || '';
    }

    function truncate(text, maxLength) {
        if (text.length <= maxLength) return text;
        return text.substr(0, maxLength).trim() + '...';
    }

    async function loadBlogPosts() {
        const container = document.getElementById('blog-posts-container');

        try {
            const response = await fetch('/wp-json/wp/v2/posts?per_page=3&_embed');

            if (!response.ok) {
                throw new Error('Failed to fetch posts');
            }

            const posts = await response.json();
            container.innerHTML = '';

            if (posts.length === 0) {
                container.innerHTML = '<div class="blog-card"><div class="blog-card-content"><h3>No posts yet</h3><p>Check back soon for updates!</p></div></div>';
                return;
            }

            posts.forEach(post => {
                let imageUrl = '';
                if (post._embedded && post._embedded['wp:featuredmedia'] && post._embedded['wp:featuredmedia'][0]) {
                    imageUrl = post._embedded['wp:featuredmedia'][0].source_url;
                }

                let excerpt = '';
                if (post.excerpt && post.excerpt.rendered) {
                    excerpt = stripHtml(post.excerpt.rendered);
                } else if (post.content && post.content.rendered) {
                    excerpt = stripHtml(post.content.rendered);
                }
                excerpt = truncate(excerpt, 150);

                const title = post.title.rendered;
                const link = post.link;

                const cardHtml = '<div class="blog-card"><div class="blog-card-image" style="' + (imageUrl ? 'background-image: url(\'' + imageUrl + '\'); background-size: cover; background-position: center;' : '') + '">' + (imageUrl ? '' : 'Blog Image') + '</div><div class="blog-card-content"><h3>' + title + '</h3><p>' + excerpt + '</p><a href="' + link + '">Read More →</a></div></div>';

                container.innerHTML += cardHtml;
            });

        } catch (error) {
            console.error('Error loading blog posts:', error);
            container.innerHTML = '<div class="blog-card"><div class="blog-card-content"><h3>Unable to load posts</h3><p>Please check back later or visit our <a href="/blog">blog page</a> directly.</p></div></div>';
        }
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadBlogPosts);
    } else {
        loadBlogPosts();
    }
})();
</script>

<!-- Footer CTA -->
<section class="footer-cta">
    <div class="container">
        <h2>Ready to Get Started?</h2>
        <p>Join hundreds of boaters using d3kOS to monitor their vessels</p>
        <a href="#tiers" class="tier-button">Choose Your Tier</a>
    </div>
</section>

<!-- Blog Subscription Popup -->
<div id="blog-subscribe-popup" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); z-index: 9999; align-items: center; justify-content: center;">
    <div style="background: #2a2a2a; border: 3px solid #BFFF00; border-radius: 12px; padding: 40px; max-width: 500px; width: 90%; position: relative; box-shadow: 0 10px 40px rgba(191, 255, 0, 0.3);">
        <button id="popup-close" style="position: absolute; top: 15px; right: 15px; background: transparent; border: none; color: #BFFF00; font-size: 28px; cursor: pointer; line-height: 1; padding: 0; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center;" aria-label="Close">×</button>

        <div style="text-align: center;">
            <h3 style="font-size: 28px; color: #BFFF00; margin-bottom: 15px; font-weight: 600;">Stay Updated on Marine Electronics</h3>
            <p style="font-size: 16px; color: #ffffff; margin-bottom: 25px; line-height: 1.6;">Get DIY guides, d3kOS updates, and boating tips delivered to your inbox. Join our community of modern boaters!</p>

            <form id="blog-subscribe-form" style="margin-bottom: 20px;">
                <input type="email" id="subscriber-email" placeholder="Enter your email address" required style="width: 100%; padding: 15px; font-size: 16px; border: 2px solid #3a3a3a; background: #1a1a1a; color: #ffffff; border-radius: 8px; margin-bottom: 15px; box-sizing: border-box;">

                <button type="submit" style="width: 100%; background: #BFFF00; color: #000000; padding: 15px; font-size: 18px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer; transition: background 0.3s ease;">Subscribe to Blog Updates</button>
            </form>

            <p style="font-size: 13px; color: #cccccc; line-height: 1.5;">We respect your privacy. <a href="/unsubscribe" style="color: #BFFF00; text-decoration: none;">Unsubscribe</a> anytime. No spam, just quality marine electronics content.</p>
        </div>
    </div>
</div>

<script>
(function() {
    const POPUP_DELAY = 5000;
    const COOKIE_NAME = 'blog_popup_dismissed';
    const COOKIE_DAYS = 30;

    function setCookie(name, value, days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        const expires = 'expires=' + date.toUTCString();
        document.cookie = name + '=' + value + ';' + expires + ';path=/';
    }

    function getCookie(name) {
        const nameEQ = name + '=';
        const ca = document.cookie.split(';');
        for (let i = 0; i < ca.length; i++) {
            let c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }

    function hasUserDismissed() {
        return getCookie(COOKIE_NAME) === 'true';
    }

    function showPopup() {
        const popup = document.getElementById('blog-subscribe-popup');
        if (popup) {
            popup.style.display = 'flex';
        }
    }

    function hidePopup() {
        const popup = document.getElementById('blog-subscribe-popup');
        if (popup) {
            popup.style.display = 'none';
        }
    }

    function dismissPopup() {
        hidePopup();
        setCookie(COOKIE_NAME, 'true', COOKIE_DAYS);
    }

    function handleFormSubmit(e) {
        e.preventDefault();

        const emailInput = document.getElementById('subscriber-email');
        const email = emailInput.value.trim();

        if (!email) {
            alert('Please enter a valid email address.');
            return;
        }

        const subscribers = JSON.parse(localStorage.getItem('blog_subscribers') || '[]');
        if (!subscribers.includes(email)) {
            subscribers.push(email);
            localStorage.setItem('blog_subscribers', JSON.stringify(subscribers));
        }

        const popup = document.getElementById('blog-subscribe-popup');
        const popupContent = popup.querySelector('div > div');
        popupContent.innerHTML = '<div style="text-align: center; padding: 20px;"><div style="font-size: 48px; color: #BFFF00; margin-bottom: 20px;">✓</div><h3 style="font-size: 28px; color: #BFFF00; margin-bottom: 15px;">Thanks for Subscribing!</h3><p style="font-size: 16px; color: #ffffff; margin-bottom: 25px;">You\'ll receive our latest marine electronics content and d3kOS updates.</p><button onclick="document.getElementById(\'blog-subscribe-popup\').style.display=\'none\'" style="background: #BFFF00; color: #000000; padding: 12px 30px; font-size: 16px; font-weight: 600; border: none; border-radius: 8px; cursor: pointer;">Close</button></div>';

        setTimeout(dismissPopup, 3000);
    }

    function initPopup() {
        if (hasUserDismissed()) {
            return;
        }

        setTimeout(showPopup, POPUP_DELAY);

        const closeBtn = document.getElementById('popup-close');
        if (closeBtn) {
            closeBtn.addEventListener('click', dismissPopup);
        }

        const popup = document.getElementById('blog-subscribe-popup');
        if (popup) {
            popup.addEventListener('click', function(e) {
                if (e.target === popup) {
                    dismissPopup();
                }
            });
        }

        const form = document.getElementById('blog-subscribe-form');
        if (form) {
            form.addEventListener('submit', handleFormSubmit);
        }
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initPopup);
    } else {
        initPopup();
    }
})();
</script>
